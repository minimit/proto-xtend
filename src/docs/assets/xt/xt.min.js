/*! xtend v0.0.6 (http://www.minimit.com/xtend/)
@copyright (c) 2016 - 2017 Riccardo Caroli
@license MIT (https://github.com/minimit/xtend/blob/master/LICENSE) */
!function(t,e,s,a){"use strict";var i=function(e,s,a){this.element=e,this.settings=t.extend({},a,s),this.init()};t.fn.xt=function(e){var s={name:"xt",type:"plugin_xt",on:"click",target:null,class:"active",group:null,grouping:"xt",min:0,max:1};return this.each(function(){t.data(this,"plugin_xt")||t.data(this,"plugin_xt",new i(this,e,s))})};var r=function(t,e,s){i.call(this,t,e,s)};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,t.fn.xtToggle=function(e){var s={name:"xt-toggle",type:"plugin_xtToggle",on:"click",target:null,class:"active",group:null,grouping:"xtToggle",min:0,max:1};return this.each(function(){t.data(this,"plugin_xtToggle")||t.data(this,"plugin_xtToggle",new r(this,e,s))})};var n=function(t,e,s){i.call(this,t,e,s)};n.prototype=Object.create(i.prototype),n.prototype.constructor=n,t.fn.xtMenu=function(e){var s={name:"xt-menu",type:"plugin_xtMenu",on:"click",target:"html",class:"menu",group:null,grouping:"xtMenu",min:0,max:1};return this.each(function(){t.data(this,"plugin_xtMenu")||t.data(this,"plugin_xtMenu",new n(this,e,s))})};var o=function(t,e,s){i.call(this,t,e,s)};o.prototype=Object.create(i.prototype),o.prototype.constructor=o,t.fn.xtScroll=function(e){var s={name:"xt-scroll",type:"plugin_xtScroll",on:"scroll",target:null,class:"scroll",group:null,grouping:"xtScroll",min:0,max:1};return this.each(function(){t.data(this,"plugin_xtScroll")||t.data(this,"plugin_xtScroll",new o(this,e,s))})};var l=function(t,e,s){i.call(this,t,e,s)};l.prototype=Object.create(i.prototype),l.prototype.constructor=l,t.fn.xtAjax=function(e){var s={name:"xt-ajax",type:"plugin_xtAjax",on:"click",target:null,class:"active",group:null,grouping:"xtAjax",url:null};return this.each(function(){t.data(this,"plugin_xtAjax")||t.data(this,"plugin_xtAjax",new l(this,e,s))})},t.fn.xtInitAll=function(e){return this.each(function(){t(this).is("[data-xt]")&&t(this).xt(),t(this).is("[data-xt-toggle]")&&t(this).xtToggle(),t(this).is("[data-xt-menu]")&&t(this).xtMenu(),t(this).is("[data-xt-scroll]")&&t(this).xtScroll(),t(this).is("[data-xt-ajax]")&&t(this).xtAjax(),e&&(t(this).find("[data-xt]").xt(),t(this).find("[data-xt-toggle]").xtToggle(),t(this).find("[data-xt-menu]").xtMenu(),t(this).find("[data-xt-scroll]").xtScroll(),t(this).find("[data-xt-ajax]").xtAjax())})},t.fn.xt.initAjax=function(e){t('a[href^="'+e.baseurl+'"]').xtAjax({target:e.target}),t(e.target).off("ajax.populated.xt.populate"),t(e.target).on("ajax.populated.xt.populate",function(s,a,i){t(this).find('a[href^="'+e.baseurl+'"]').xtAjax({target:e.target})})},i.prototype.init=function(){var e=this.settings,s=(this.element,t(this.element));(s.attr("debug")||""===s.attr("debug"))&&(e.debug=!0),t.extend(e,s.data(e.name)),this.scoping(),this.setup(),this.events()},i.prototype.scoping=function(){var s=this.settings,a=(this.element,t(this.element));"xt-scroll"===s.name?(a.wrap(t('<div class="box xt-container"></div>')),s.$target=a.clone().addClass("box xt-ignore").css("visibility","hidden"),t.each(s.$target.data(),function(t){s.$target.removeAttr("data-"+t)}),s.$target.insertAfter(a),s.$group=a.parents(".xt-container")):"html"===s.target||"xt-ajax"===s.name?(s.$target=t(s.target),s.$group=s.$target):s.group?(s.$group=a.parents(s.group),s.target&&(s.$target=s.$group.find(s.target))):(s.$group=a,s.target&&(s.$target=s.$group.find(s.target),s.$target.length||(s.$group=a.parent(),s.$target=s.$group.find(s.target),s.$target.length||(s.$target=a.parents(s.target),s.$group=s.$target)))),a.attr("data-xt-initialized",s.name),e.uuid=e.uuid?e.uuid:0;var i=s.$group.attr("id")?s.$group.attr("id"):"xt-id-"+e.uuid++;s.$group.attr("id",i),s.namespace=s.grouping+"_"+i+"_"+s.class,a.attr("data-xt-element-"+s.name,s.namespace)},i.prototype.setup=function(){var a=this,i=this.settings,r=(this.element,t(this.element));"xt-ajax"===i.name&&(i.url=r.attr("href"));var n=this.getButtons();if(n.each(function(e){t(this).is(r)&&(i.groupIndex=e)}),i.$target&&i.$target.length>1&&(i.$target=i.$target.eq(i.groupIndex)),i.$target&&i.$target.hasClass("xt-height")&&i.$target.wrapInner('<div class="xt-height-inside"></div>'),i.url){var o;if(history.state&&history.state.url)i.url===history.state.url&&(o=!0);else{var l=e.location.href.split("#")[0];l=l.replace(/https?:\/\/[^\/]+/i,""),l===i.url&&(o=!0)}o&&(i.title=i.title?i.title:s.title,i.$target.attr("data-xt-ajaxified",i.url),this.pushstate(),this.show(),i.$target.trigger("ajax.init.xt",[a]))}else r.hasClass(i.class)&&(r.removeClass(i.class),this.show()),e.requestAnimFrame(function(){n=a.getButtons();var t=i.min,e=n.filter("."+i.class);3===i.max&&console.log(e.length),e.length<t&&a.show()})},i.prototype.events=function(){var s=this,a=this.settings,i=(this.element,t(this.element));if("xt-scroll"===a.name){var r="scroll.xt."+a.namespace;t(e).off(r),t(e).on(r,function(r){var n=t(this).scrollTop(),o=i.parents(".xt-container").offset().top,l=1/0;a.scrollTop&&(o=t(a.scrollTop).offset().top),a.scrollBottom&&(l=t(a.scrollBottom).offset().top),n>o&&n<l?i.hasClass(a.class)||(s.show(),i.removeClass("scroll-hide-up scroll-hide-down"),a.scrollOld>n?(i.removeClass("scroll-show-down"),e.requestAnimFrame(function(){i.addClass("scroll-show-up")})):(i.removeClass("scroll-show-up"),e.requestAnimFrame(function(){i.addClass("scroll-show-down")}))):i.hasClass(a.class)&&(s.hide(),i.removeClass("scroll-show-up scroll-show-down"),a.scrollOld>n?(i.removeClass("scroll-hide-down"),e.requestAnimFrame(function(){i.addClass("scroll-hide-up")})):(i.removeClass("scroll-hide-up"),e.requestAnimFrame(function(){i.addClass("scroll-hide-down")}))),a.scrollOld=n}),t(e).trigger(r),i.on("xtRemoved",function(s){t(e).off(r)})}else i.on(a.on,function(t){s.toggle(),a.url&&t.preventDefault()}),i.on(a.off,function(t){s.toggle()});i.on("toggle.xt",function(t,e,a){a||t.target!==this||(s.toggle(!0),console.log(i.text().replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+|\s+$|\s+(?=\s)/g,"")))}),i.on("show.xt",function(t,e,a){a||t.target!==this||s.show(!0)}),i.on("hide.xt",function(t,e,a){a||t.target!==this||s.hide(!0)}),(i.is("[data-xt-reset]")||"html"===a.target)&&i.on("xtRemoved",function(t){s.hide(!1,!0,!0)})},i.prototype.getButtons=function(){var e=this.settings,s=(this.element,t(this.element),e.$group.find("[data-xt-element-"+e.name+'="'+e.namespace+'"]').filter(":parents(.xt-ignore)"));return s},i.prototype.getCurrents=function(){var e=this.settings,s=(this.element,t(this.element),e.$group.data("$currents_"+e.namespace)||t([]));return s},i.prototype.setCurrents=function(e){var s=this.settings;this.element,t(this.element);return s.$group.data("$currents_"+s.namespace,e),e},i.prototype.toggle=function(e,s,a){var i=this,r=this.settings,n=(this.element,t(this.element)),o=this.getButtons();n.hasClass(r.class)?r.url||(this.hide(e,s,a),o.each(function(s){var i=t(this).data(r.type);i.settings.$target&&i.settings.$target.is(r.$target)&&i.hide(e,!0,a)})):(this.show(e,s,a),r.url||o.each(function(s){var i=t(this).data(r.type);i.settings.$target&&i.settings.$target.is(r.$target)&&i.show(e,!0,a)})),e||(n.trigger("toggle.xt",[i,!0]),r.$target&&r.$target.trigger("toggle.xt",[i,!0]))},i.prototype.show=function(e,s,a){var i=this,r=this.settings,n=(this.element,t(this.element));if(!n.hasClass(r.class)){var o,l=this.getCurrents();if(n.addClass(r.class),l=this.setCurrents(l.pushElement(n)),r.$target&&!r.$target.hasClass(r.class)&&(o=!0,r.$target.addClass(r.class),r.$target.hasClass("xt-height"))){var h=r.$target.find(".xt-height-inside").outerHeight();r.$target.css("height",h),r.$target.parents(".xt-height-top").css("margin-top",-h),r.$target.parents(".xt-height-bottom").css("margin-bottom",-h)}if(r.url)this.checkDisabled("disable"),i.ajax(e,s,a);else if(this.checkDisabled(),!s&&l.length>r.max){var g=l.first().data(r.type);g&&g.hide()}e||(n.trigger("show.xt",[i,!0]),o&&r.$target.trigger("show.xt",[i,!0]))}},i.prototype.hide=function(e,s,a){var i=this,r=this.settings,n=this.element,o=t(this.element);if(o.hasClass(r.class)){var l,h=this.getCurrents();(s||r.url||h.length>r.min)&&(o.removeClass(r.class),h=this.setCurrents(h.not(n)),r.$target&&r.$target.hasClass(r.class)&&(l=!0,r.$target.removeClass(r.class),r.$target.hasClass("xt-height")&&(r.$target.css("height",0),r.$target.parents(".xt-height-top").css("margin-top",0),r.$target.parents(".xt-height-bottom").css("margin-bottom",0)))),s||r.url?this.checkDisabled("enable"):this.checkDisabled(),e||(o.trigger("hide.xt",[i,!0]),l&&r.$target.trigger("hide.xt",[i,!0]))}},i.prototype.checkDisabled=function(e){var s=this.settings,a=(this.element,t(this.element));if("click"===s.on)if(e)"disable"===e?a.attr("disabled",""):"enable"===e&&a.removeAttr("disabled");else{var i=this.getCurrents(),r=s.min;i.length===r?i.attr("disabled",""):i.removeAttr("disabled")}},i.prototype.ajax=function(e,s,a){var i=this,r=this.settings;this.element,t(this.element);r.$target.attr("data-xt-ajaxified")!==r.url&&t.ajax({type:"GET",url:r.url,success:function(e,s,n){var o=t("<div />").html(e);r.$target.trigger("ajax.success.xt",[i,o]);var l=o.find(r.target).contents();r.$target.html(l),r.$target.attr("data-xt-ajaxified",r.url),a||(r.title=r.title?r.title:o.find("title").text(),i.pushstate(!0)),r.$target.trigger("ajax.populated.xt",[i,o])},error:function(t,e,s){console.error("ajax error url:"+r.url+" "+s)}})},i.prototype.pushstate=function(e){var a=this.settings,i=(this.element,t(this.element),a.title);if(!history.state||!history.state.url||history.state.url!==a.url){var r=a.url;history.pushState({url:r,title:i},i,r),t(s).find('[data-xt-initialized="xt-ajax"]').filter(":parents(.xt-ignore)").each(function(s){var i=t(this).data(a.type);i&&i.pushstateListener(r,e)})}s.title=i},i.prototype.pushstateListener=function(e,s){var a=this,i=this.settings;this.element,t(this.element);i.url===e?a.show(s,!1,!0):a.hide(s,!1,!0)},e.onpopstate=function(e){e.state&&e.state.url&&(s.title=e.state.title,t(s).find('[data-xt-initialized="xt-ajax"]').filter(":parents(.xt-ignore)").each(function(s,a){var i=t(this).data("plugin_xtAjax");i.pushstateListener(e.state.url)}))},e.requestAnimFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)}}(),t.fn.pushElement=function(t){return Array.prototype.push.apply(this,t),this},t.event.special.xtRemoved={remove:function(t){t.handler&&t.handler()}},t.expr[":"].parents=function(e,s,a){return t(e).parents(a[3]).length<1}}(jQuery,window,document);