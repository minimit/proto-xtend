/*! xtend v0.0.6 (http://www.minimit.com/xtend/)
@copyright (c) 2016 - 2017 Riccardo Caroli
@license MIT (https://github.com/minimit/xtend/blob/master/LICENSE) */
!function(t,e,s,a){"use strict";var i=function(e,s,a){this.group=e,this.settings=t.extend({},a,s),this.init()},r=function(t,e,s){i.call(this,t,e,s)};r.prototype=Object.create(i.prototype),r.prototype.constructor=r,t.fn.xtToggle=function(e){var s={name:"xt-toggle",type:"plugin_xtToggle",elements:null,targets:null,class:"active",on:"click",off:null,min:0,max:1};return this.each(function(){t.data(this,s.type)||t.data(this,s.type,new r(this,e,s))})};var n=function(t,e,s){i.call(this,t,e,s)};n.prototype=Object.create(i.prototype),n.prototype.constructor=n,t.fn.xtMenu=function(e){var s={name:"xt-menu",type:"plugin_xtMenu",targets:"html",on:"click",class:"menu",min:0,max:1};return this.each(function(){t.data(this,s.type)||t.data(this,s.type,new n(this,e,s))})};var o=function(t,e,s){i.call(this,t,e,s)};o.prototype=Object.create(i.prototype),o.prototype.constructor=o,t.fn.xtScroll=function(e){var s={name:"xt-scroll",type:"plugin_xtScroll",targets:"$clone",on:"scroll",class:"scroll",min:0,max:1};return this.each(function(){t.data(this,s.type)||t.data(this,s.type,new o(this,e,s))})};var l=function(t,e,s){i.call(this,t,e,s)};l.prototype=Object.create(i.prototype),l.prototype.constructor=l,t.fn.xtAjax=function(e){var s={name:"xt-ajax",type:"plugin_xtAjax",targets:null,on:"click",class:"active",url:null};return this.each(function(){t.data(this,"plugin_xtAjax")||t.data(this,"plugin_xtAjax",new l(this,e,s))})},t.fn.xtInitAll=function(e){return this.each(function(){t(this).is("[data-xt-toggle]")&&t(this).xtToggle(),t(this).is("[data-xt-menu]")&&t(this).xtMenu(),t(this).is("[data-xt-scroll]")&&t(this).xtScroll(),t(this).is("[data-xt-ajax]")&&t(this).xtAjax(),e&&(t(this).find("[data-xt-toggle]").xtToggle(),t(this).find("[data-xt-menu]").xtMenu(),t(this).find("[data-xt-scroll]").xtScroll(),t(this).find("[data-xt-ajax]").xtAjax())})},t.fn.xtAjax.initAjax=function(e){t('a[href^="'+e.baseurl+'"]').xtAjax({targets:e.targets}),t(e.targets).off("ajax.populated.xt.populate"),t(e.targets).on("ajax.populated.xt.populate",function(s,a,i){t(this).find('a[href^="'+e.baseurl+'"]').xtAjax({targets:e.targets})})},i.prototype.init=function(){var e=this.settings,s=(this.group,t(this.group));(s.attr("debug")||""===s.attr("debug"))&&(e.debug=!0),t.extend(e,s.data(e.name)),this.scoping(),this.setup(),this.events()},i.prototype.scoping=function(){var s=this.settings,a=(this.group,t(this.group));s.elements?s.$elements=a.find(s.elements):s.$elements=a,"$clone"===s.targets?(a.wrap(t('<div class="box xt-container"></div>')),s.$targets=a.clone().addClass("box xt-ignore").css("visibility","hidden"),t.each(s.$targets.data(),function(t){s.$targets.removeAttr("data-"+t)}),s.$targets.insertAfter(a)):"html"===s.targets||"xt-ajax"===s.name?s.$targets=t(s.targets):s.$targets=a.find(s.targets),a.attr("data-xt-initialized",s.name),e.uuid=e.uuid?e.uuid:0;var i=a.attr("id")?a.attr("id"):"xt-id-"+e.uuid++;a.attr("id",i),s.namespace=s.name+"_"+i+"_"+s.class,a.attr("data-xt-group-"+s.name,s.namespace)},i.prototype.setup=function(){var a=this,i=this.settings,r=(this.group,t(this.group));if("xt-ajax"===i.name&&(i.url=r.attr("href")),i.$targets&&i.$targets.hasClass("xt-height")&&i.$targets.wrapInner('<div class="xt-height-inside"></div>'),i.url){var n;if(history.state&&history.state.url)i.url===history.state.url&&(n=!0);else{var o=e.location.href.split("#")[0];o=o.replace(/https?:\/\/[^\/]+/i,""),o===i.url&&(n=!0)}n&&(i.title=i.title?i.title:s.title,i.$targets.attr("data-xt-ajaxified",i.url),this.pushstate(),this.show(),i.$targets.trigger("ajax.init.xt",[a]))}else i.$elements&&(i.$elements.each(function(){t(this).hasClass(i.class)&&(t(this).removeClass(i.class),a.show(t(this)))}),e.requestAnimFrame(function(){var t=i.min,e=i.$elements.filter("."+i.class);e.length<t&&a.show(i.$elements.eq(0))}))},i.prototype.events=function(){var s=this,a=this.settings,i=(this.group,t(this.group));if("xt-scroll"===a.name){var r="scroll.xt."+a.namespace;t(e).off(r),t(e).on(r,function(r){var n=t(this).scrollTop(),o=i.parents(".xt-container").offset().top,l=1/0;a.scrollTop&&(o=t(a.scrollTop).offset().top),a.scrollBottom&&(l=t(a.scrollBottom).offset().top),n>o&&n<l?i.hasClass(a.class)||(s.show(i),i.removeClass("scroll-hide-up scroll-hide-down"),a.scrollOld>n?(i.removeClass("scroll-show-down"),e.requestAnimFrame(function(){i.addClass("scroll-show-up")})):(i.removeClass("scroll-show-up"),e.requestAnimFrame(function(){i.addClass("scroll-show-down")}))):i.hasClass(a.class)&&(s.hide(i),i.removeClass("scroll-show-up scroll-show-down"),a.scrollOld>n?(i.removeClass("scroll-hide-down"),e.requestAnimFrame(function(){i.addClass("scroll-hide-up")})):(i.removeClass("scroll-hide-up"),e.requestAnimFrame(function(){i.addClass("scroll-hide-down")}))),a.scrollOld=n}),t(e).trigger(r),i.on("xtRemoved",function(s){t(e).off(r)})}else a.$elements&&(a.on&&a.$elements.on(a.on,function(e){s.toggle(t(this)),a.url&&e.preventDefault()}),a.off&&a.$elements.on(a.off,function(e){s.toggle(t(this))}),a.$elements.on("xtRemoved",function(e){(t(this).is("[data-xt-reset]")||"html"===a.targets)&&s.hide(t(this),!1,!0,!0)}))},i.prototype.getCurrents=function(){var e=this.settings,s=(this.group,t(this.group)),a=s.data("$currents_"+e.namespace)||t([]);return a},i.prototype.setCurrents=function(e){var s=this.settings,a=(this.group,t(this.group));return a.data("$currents_"+s.namespace,e),e},i.prototype.toggle=function(e,s,a,i){var r=this,n=this.settings;this.group,t(this.group);e.hasClass(n.class)?n.url||this.hide(e,s,a,i):this.show(e,s,a,i),s||(e.trigger("toggle.xt",[r,!0]),n.$targets&&n.$targets.trigger("toggle.xt",[r,!0]))},i.prototype.show=function(e,s,a,i){var r=this,n=this.settings;this.group,t(this.group);if(e&&!e.hasClass(n.class)){var o=this.getCurrents();e.addClass(n.class),o=this.setCurrents(o.pushElement(e)),n.url?(this.checkDisabled(e,"disable"),r.ajax(s,a,i)):(this.checkDisabled(e),a||o.length>n.max&&this.hide(o.first())),s||e.trigger("show.xt",[r,!0])}if(n.$targets){var l=this.getIndex(n.$elements,e);l=l>=n.$targets.length?n.$targets.length-1:l;var h=n.$targets.eq(l);if(!h.hasClass(n.class)){if(h.addClass(n.class),h.hasClass("xt-height")){var u=h.find(".xt-height-inside").outerHeight();h.css("height",u),h.parents(".xt-height-top").css("margin-top",-u),h.parents(".xt-height-bottom").css("margin-bottom",-u)}s||h.trigger("show.xt",[r,!0])}}},i.prototype.hide=function(e,s,a,i){var r=this,n=this.settings;this.group,t(this.group);if(e&&e.hasClass(n.class)){var o=this.getCurrents();(a||n.url||o.length>n.min)&&(e.removeClass(n.class),o=this.setCurrents(o.not(e.get(0)))),a||n.url?this.checkDisabled(e,"enable"):this.checkDisabled(e),s||e.trigger("hide.xt",[r,!0])}if(n.$targets){var l=this.getIndex(n.$elements,e);l=l>=n.$targets.length?n.$targets.length-1:l;var h=n.$targets.eq(l);h.hasClass(n.class)&&(h.removeClass(n.class),h.hasClass("xt-height")&&(h.css("height",0),h.parents(".xt-height-top").css("margin-top",0),h.parents(".xt-height-bottom").css("margin-bottom",0))),s||h.trigger("hide.xt",[r,!0])}},i.prototype.getIndex=function(e,s){var a=0;return e&&s&&e.each(function(e){if(t(this).is(s.get(0)))return a=e,!1}),a},i.prototype.checkDisabled=function(e,s){var a=this.settings;this.group,t(this.group);if("click"===a.on)if(s)"disable"===s?e.attr("disabled",""):"enable"===s&&e.removeAttr("disabled");else{var i=this.getCurrents(),r=a.min;i.length===r?i.attr("disabled",""):i.removeAttr("disabled")}},i.prototype.ajax=function(e,s,a){var i=this,r=this.settings;this.group,t(this.group);r.$targets.attr("data-xt-ajaxified")!==r.url&&t.ajax({type:"GET",url:r.url,success:function(e,s,n){var o=t("<div />").html(e);r.$targets.trigger("ajax.success.xt",[i,o]);var l=o.find(r.targets).contents();r.$targets.html(l),r.$targets.attr("data-xt-ajaxified",r.url),a||(r.title=r.title?r.title:o.find("title").text(),i.pushstate(!0)),r.$targets.trigger("ajax.populated.xt",[i,o])},error:function(t,e,s){console.error("ajax error url:"+r.url+" "+s)}})},i.prototype.pushstate=function(e){var a=this.settings,i=(this.group,t(this.group),a.title);if(!history.state||!history.state.url||history.state.url!==a.url){var r=a.url;history.pushState({url:r,title:i},i,r),t(s).find('[data-xt-initialized="xt-ajax"]').filter(":parents(.xt-ignore)").each(function(s){var i=t(this).data(a.type);i&&i.pushstateListener(r,e)})}s.title=i},i.prototype.pushstateListener=function(e,s){var a=this,i=this.settings;this.group,t(this.group);i.url===e?a.show(s,!1,!0):a.hide(s,!1,!0)},e.onpopstate=function(e){e.state&&e.state.url&&(s.title=e.state.title,t(s).find('[data-xt-initialized="xt-ajax"]').filter(":parents(.xt-ignore)").each(function(s,a){var i=t(this).data("plugin_xtAjax");i.pushstateListener(e.state.url)}))},e.requestAnimFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)}}(),t.fn.pushElement=function(t){return Array.prototype.push.apply(this,t),this},t.event.special.xtRemoved={remove:function(t){t.handler&&t.handler()}},t.expr[":"].parents=function(e,s,a){return t(e).parents(a[3]).length<1}}(jQuery,window,document);